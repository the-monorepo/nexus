{"version":3,"sources":["../src/index.ts"],"names":["propTypeMatches","testedPropType","expectedPropType","isRequired","isCssColorSymb","Symbol","knobBasedOffExamples","value","typeInfo","key","types","length","type","name","DefaultTypeName","number","boolean","string","array","function","object","knobOfField","fields","shimDefaultTypeTests","typeTests","Object","keys","reduce","newTypeTests","typeCheck","example","propData","examples","map","withPropTypeCheck","checkProps","data","defaultProp","propType","knobTypeTests","extractTypeInfoFn","defaultTests","ogValueFn","ogValue","isColor","undefined","PropTypes","bool","propKeys","Component","propTypes","defaultProps","Set","concat","extractKnobInfo","options","Array","from","values","datum","fromExamples","isArray","objectFields","nullCount","undefinedCount","knobified","Error","join","rootType","fieldKey"],"mappings":"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","sourcesContent":["// TODO: Should probably mock @storybook/addon-knobs\nimport { text, boolean, number, object, array, color } from '@storybook/addon-knobs';\nimport { action } from '@storybook/addon-actions';\nimport {\n  ObjectType,\n  DefaultTypeName,\n  TypeInfo,\n  extractTypeInfo,\n  defaultTypeTests,\n} from '@byexample/types';\nimport { isCssColor } from 'css-color-checker';\nimport PropTypes from 'prop-types';\n\nfunction propTypeMatches(testedPropType, expectedPropType) {\n  if (testedPropType === expectedPropType) {\n    return true;\n  } else if (\n    expectedPropType.isRequired &&\n    expectedPropType.isRequired === testedPropType\n  ) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nexport const isCssColorSymb = Symbol('isCssColor');\n\nfunction knobBasedOffExamples(value, typeInfo: TypeInfo, key) {\n  if (typeInfo.types.length === 1) {\n    const type = typeInfo.types[0];\n    switch (type.name) {\n      case DefaultTypeName.number:\n        return number(key, value);\n      case DefaultTypeName.boolean:\n        return boolean(key, value);\n      case DefaultTypeName.string:\n        return type[isCssColorSymb] ? color(key, value) : text(key, value);\n      case DefaultTypeName.array:\n        return array(key, !!value ? value : []);\n      case DefaultTypeName.function:\n        return action(key, value);\n      case DefaultTypeName.object:\n      default:\n        return object(key, value);\n    }\n  } else {\n    return object(key, value);\n  }\n}\n\nfunction knobOfField(value, fields, key) {\n  return knobBasedOffExamples(value, fields[key], key);\n}\n\nfunction shimDefaultTypeTests(typeTests) {\n  return Object.keys(typeTests).reduce((newTypeTests, key) => {\n    newTypeTests[key] = {\n      typeCheck: ({ example }) => {\n        return typeTests[key].typeCheck(example);\n      },\n      value: propData => {\n        const examples = propData.map(({ example }) => example);\n        return typeTests[key].value(examples);\n      },\n    };\n    return newTypeTests;\n  }, {});\n}\n\nfunction withPropTypeCheck(typeCheck, expectedPropType) {\n  function checkProps(data) {\n    return typeCheck({ example: data.defaultProp }) || typeCheck(data);\n  }\n  return data => {\n    const { propType } = data;\n    if (propType) {\n      return propTypeMatches(propType, expectedPropType) || checkProps(data);\n    }\n    return checkProps(data);\n  };\n}\n\nfunction knobTypeTests(extractTypeInfoFn) {\n  // TODO: Remove the any\n  const defaultTests: any = defaultTypeTests(extractTypeInfoFn);\n  const ogValueFn = defaultTests.string.value;\n  defaultTests.string.value = examples => {\n    const ogValue = ogValueFn(examples);\n    let isColor = true;\n    for (const example of examples) {\n      if (example !== undefined && example !== null && !isCssColor(example)) {\n        isColor = false;\n        break;\n      }\n    }\n    return {\n      ...ogValue,\n      [isCssColorSymb]: isColor,\n    };\n  };\n\n  const typeTests = shimDefaultTypeTests(defaultTests) as any;\n  typeTests.string.typeCheck = withPropTypeCheck(\n    typeTests.string.typeCheck,\n    PropTypes.string,\n  );\n  typeTests.number.typeCheck = withPropTypeCheck(\n    typeTests.number.typeCheck,\n    PropTypes.number,\n  );\n  typeTests.boolean.typeCheck = withPropTypeCheck(\n    typeTests.boolean.typeCheck,\n    PropTypes.bool,\n  );\n  typeTests.object.typeCheck = withPropTypeCheck(\n    typeTests.object.typeCheck,\n    PropTypes.object,\n  );\n  typeTests.array.typeCheck = withPropTypeCheck(\n    typeTests.array.typeCheck,\n    PropTypes.array,\n  );\n  return typeTests;\n}\n\nfunction propKeys(examples, Component = {}) {\n  const { propTypes = {}, defaultProps = {} } = Component as any;\n\n  return new Set(\n    [].concat(\n      Object.keys(propTypes ? propTypes : {}),\n      Object.keys(defaultProps ? defaultProps : {}),\n      ...examples.map(example => Object.keys(example)),\n    ),\n  );\n}\n\nfunction extractKnobInfo(examples, Component = {}, options) {\n  const { propTypes = {}, defaultProps = {} } = Component as any;\n  const keys = propKeys(examples, Component);\n  // Wasteful copying of proptype and default prop data\n  const typeInfo = Array.from(keys.values()).reduce((datum, key) => {\n    datum[key] = extractTypeInfo(\n      examples.map(example => ({\n        example: example[key],\n        propType: propTypes[key],\n        defaultProp: defaultProps[key],\n      })),\n      knobTypeTests(extractKnobInfo),\n    );\n    return datum;\n  }, {});\n  return typeInfo;\n}\n\nexport function fromExamples(\n  examples: any | any[],\n  Component?: React.Component,\n  options = {},\n) {\n  if (!Array.isArray(examples)) {\n    examples = [examples];\n  }\n  const objectFields = extractKnobInfo(examples, Component, options);\n  const typeInfo = {\n    types: [\n      {\n        name: DefaultTypeName.object,\n        fields: objectFields,\n      },\n    ],\n    nullCount: 0,\n    undefinedCount: 0,\n  };\n  return {\n    knobified: example => {\n      return knobified(example, typeInfo, options);\n    },\n  };\n}\n\nexport function knobified(example, typeInfo, options: any = {}) {\n  const { types, nullCount, undefinedCount } = typeInfo;\n  if (types.length <= 0) {\n    return;\n  }\n  if (types.length > 1) {\n    throw new Error(\n      `Expecting root values to be object types. Root value types included [ ${types\n        .map(type => type.name)\n        .join(', ')} ]`,\n    );\n  }\n  const type = types[0];\n  if (type.name !== DefaultTypeName.object) {\n    throw new Error(`Expected ${DefaultTypeName.object} but received ${type.name}`);\n  }\n  if (nullCount > 0 || undefinedCount > 0) {\n    throw new Error('No null or undefined examples are allowed');\n  }\n  const rootType: ObjectType = type as ObjectType;\n  return Object.keys(rootType.fields).reduce((knobified, fieldKey) => {\n    knobified[fieldKey] = knobOfField(example[fieldKey], rootType.fields, fieldKey);\n    return knobified;\n  }, {});\n}\n"],"file":"index.js"}